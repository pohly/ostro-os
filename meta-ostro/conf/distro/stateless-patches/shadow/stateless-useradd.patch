Index: shadow-4.2.1/src/useradd.c
===================================================================
--- shadow-4.2.1.orig/src/useradd.c
+++ shadow-4.2.1/src/useradd.c
@@ -867,6 +867,17 @@ static void grp_update (void)
 	struct sgrp *nsgrp;
 #endif
 
+	char **ug_iter = NULL;
+	/* Load missing groups from altfiles */
+	for (ug_iter = user_groups; ug_iter && *ug_iter; ug_iter++) {
+		if (gr_locate(*ug_iter) == NULL) {
+			ngrp = gralt_locate(*ug_iter);
+			if (NULL != ngrp) {
+				gr_update (ngrp);
+			}
+		}
+	}
+
 	/*
 	 * Scan through the entire group file looking for the groups that
 	 * the user is a member of.
@@ -1415,6 +1426,11 @@ static void close_files (void)
 			SYSLOG ((LOG_ERR, "failure while writing changes to %s", gr_dbname ()));
 			fail_exit (E_GRP_UPDATE);
 		}
+		if (gralt_close () == 0) {
+			fprintf (stderr,
+			         _("%s: failure while writing changes to %s\n"),
+			         Prog, gralt_dbname ());
+		}
 #ifdef	SHADOWGRP
 		if (is_shadow_grp && (sgr_close () == 0)) {
 			fprintf (stderr,
@@ -1556,6 +1572,11 @@ static void open_files (void)
 		fail_exit (E_GRP_UPDATE);
 	}
 	gr_locked = true;
+	if (gralt_open (O_RDONLY) == 0) {
+		fprintf (stderr,
+			 _("%s: cannot open %s\n"),
+			 Prog, gralt_dbname ());
+	}
 	if (gr_open (O_CREAT | O_RDWR) == 0) {
 		fprintf (stderr, _("%s: cannot open %s\n"), Prog, gr_dbname ());
 		fail_exit (E_GRP_UPDATE);
